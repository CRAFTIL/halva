@echo off
set "IMG_PATH=%USERPROFILE%\cat_wallpaper.jpg"
set "BMP_PATH=%USERPROFILE%\cat_wallpaper.bmp"
set "IMG_URL=https://az-market.net/tn_Cat_495623_3876.jpg"

:: 1. Download the image
powershell -Command "try { iwr '%IMG_URL%' -OutFile '%IMG_PATH%' } catch {}"

:: 2. Convert JPG to BMP
powershell -Command "Add-Type -AssemblyName System.Drawing; $img=[System.Drawing.Image]::FromFile('%IMG_PATH%'); $img.Save('%BMP_PATH%', [System.Drawing.Imaging.ImageFormat]::Bmp); $img.Dispose()"

:: 3. Set the Registry key
reg add "HKCU\Control Panel\Desktop" /v Wallpaper /t REG_SZ /d "%BMP_PATH%" /f

:: 4. Force Windows to update the wallpaper immediately
RUNDLL32.EXE user32.dll,UpdatePerUserSystemParameters
